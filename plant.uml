@startuml
title n-Qubit Simulator â€” Class Diagram

package "nqubitsim.gates" <<module>> {
class Gates <<utility>> {
+I, X, Y, Z, H, S, T : ndarray
+phase(theta): ndarray
+CNOT, CZ, SWAP : ndarray
+expand_single_qubit_gate(gate, target, num_qubits, use_sparse=False)
+expand_two_qubit_gate(gate, control, target, num_qubits, use_sparse=False)
+is_unitary(matrix, atol=1e-8): bool
}
}

package "nqubitsim.state" <<module>> {
class QuantumState {
+num_qubits: int
+sparse_threshold: int
+dim: int
+use_sparse: bool
-_state_vector: ndarray?
-_density_matrix: ndarray?
+__post_init__()
+is_density(): bool
+copy(): QuantumState
+vector(): ndarray
+density(): ndarray
+set_pure(vec)
+set_mixed(rho)
+as_density_matrix(): ndarray
+promote_to_density(): QuantumState
+apply_unitary(operator): QuantumState
+probabilities(qubits): ndarray
##_projector(qubits, bits): ndarray
+maybe_sparse(arr)
}
}

package "nqubitsim.measurement" <<module>> {
class Measurement <<utility>> {
##_expand_operator_on_qubits(op, qubits, num_qubits): ndarray
+projective_measure(state: QuantumState, qubits, basis=None, rng=None)
+povm_measure(state: QuantumState, operators, qubits=None, rng=None)
}
}

package "nqubitsim.noise" <<module>> {
class Noise <<utility>> {
+apply_bit_flip(state: QuantumState, p, rng=None)
+apply_depolarizing(state: QuantumState, p)
}
}

package "nqubitsim" <<module>> {
class QuantumSimulator {
+num_qubits: int
+rng: Generator
+noise_cfg: dict
+state: QuantumState
+classical_register: list<int>
+__init__(num_qubits, sparse_threshold=2**10, noise=None, rng=None)
##_apply_noise()
+apply_gate(gate, target): QuantumSimulator
+apply_controlled_gate(gate, control, target): QuantumSimulator
+measure(qubits, basis=None)
+povm(operators, qubits=None)
+reset(): QuantumSimulator
}
}

' Relationships
QuantumSimulator *-- QuantumState : owns
QuantumSimulator ..> Gates : uses gate defs & expand_*
QuantumSimulator ..> Measurement : uses projective_measure/povm_measure
QuantumSimulator ..> Noise : delegates noise hooks
Measurement ..> QuantumState : reads/updates
Noise ..> QuantumState : mutates/promotes density
Noise ..> Gates : uses expand_single_qubit_gate & X
@enduml